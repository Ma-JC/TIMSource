dataset1_1.1 = read.table("./dataset1/result_data/dataset1_Bladder_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.2 = read.table("./dataset1/result_data/dataset1_Breast_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.3 = read.table("./dataset1/result_data/dataset1_Colorectal_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.4 = read.table("./dataset1/result_data/dataset1_Esophagogastric_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.5 = read.table("./dataset1/result_data/dataset1_Glioma.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.6 = read.table("./dataset1/result_data/dataset1_Head_and_Neck_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.7 = read.table("./dataset1/result_data/dataset1_Melanoma.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.8 = read.table("./dataset1/result_data/dataset1_Non-Small_Cell_Lung_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset1_1.9 = read.table("./dataset1/result_data/dataset1_Renal_Cell_Carcinoma.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)

dataset3_1.1 = read.table("./dataset3/result_data/dataset3_Bladder_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset3_1.2 = read.table("./dataset3/result_data/dataset3_Melanoma.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset3_1.3 = read.table("./dataset3/result_data/dataset3_Non-Small_Cell_Lung_Cancer.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)


dataset1_1 = read.table("./dataset1/result_data/dataset1.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset2_1 = read.table("./dataset2/result_data/dataset2.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset3_1 = read.table("./dataset3/result_data/dataset3.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset4_1 = read.table("./dataset4/result_data/dataset4.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset5_1 = read.table("./dataset5/result_data/dataset5.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset6_1 = read.table("./dataset6/result_data/dataset6.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset7_1 = read.table("./dataset7/result_data/dataset7.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset8_1 = read.table("./dataset8/result_data/dataset8.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset9_1 = read.table("./dataset9/result_data/dataset9.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset10_1 = read.table("./dataset10/result_data/dataset10.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset11_1 = read.table("./dataset11/result_data/dataset11.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset12_1 = read.table("./dataset12/result_data/dataset12.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset13_1 = read.table("./dataset13/result_data/dataset13.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset14_1 = read.table("./dataset14/result_data/dataset14.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset15_1 = read.table("./dataset15/result_data/dataset15.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset16_1 = read.table("./dataset16/result_data/dataset16.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset17_1 = read.table("./dataset17/result_data/dataset17.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset18_1 = read.table("./dataset18/result_data/dataset18.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset19_1 = read.table("./dataset19/result_data/dataset19.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset20_1 = read.table("./dataset20/result_data/dataset20.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset21_1 = read.table("./dataset21/result_data/dataset21.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset22_1 = read.table("./dataset22/result_data/dataset22.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)
dataset23_1 = read.table("./dataset23/result_data/dataset23.txt",sep = "\t",quote = "",row.names = 1,header = T,check.names = F,stringsAsFactors = F)


data = list(
  "dataset1.1" = dataset1_1.1,
  "dataset1.2" = dataset1_1.2,
  "dataset1.3" = dataset1_1.3,
  "dataset1.4" = dataset1_1.4,
  "dataset1.5" = dataset1_1.5,
  "dataset1.6" = dataset1_1.6,
  "dataset1.7" = dataset1_1.7,
  "dataset1.8" = dataset1_1.8,
  "dataset1.9" = dataset1_1.9,
  "dataset1" = dataset1_1,
  "dataset2" = dataset2_1,
  "dataset3.1" = dataset3_1.1,
  "dataset3.2" = dataset3_1.2,
  "dataset3.3" = dataset3_1.3,
  "dataset3" = dataset3_1,
  "dataset4" = dataset4_1,
  "dataset5" = dataset5_1,
  "dataset6" = dataset6_1,
  "dataset7" = dataset7_1,
  "dataset8" = dataset8_1,
  "dataset9" = dataset9_1,
  "dataset10" = dataset10_1,
  "dataset11" = dataset11_1,
  "dataset12" = dataset12_1,
  "dataset13" = dataset13_1,
  "dataset14" = dataset14_1,
  "dataset15" = dataset15_1,
  "dataset16" = dataset16_1,
  "dataset17" = dataset17_1,
  "dataset18" = dataset18_1,
  "dataset19" = dataset19_1,
  "dataset20" = dataset20_1,
  "dataset21" = dataset21_1,
  "dataset22" = dataset22_1,
  "dataset23" = dataset23_1
)

colnames(data$dataset7)[7] = "origin_therapy"
data$dataset7$origin_therapy = "Not Available"

colnames(data$dataset17)[8] = "origin_therapy"
data$dataset17$origin_therapy = "Not Available"
data$dataset17$THERAPY = "Not Available"

data$dataset11$origin_therapy = "Not Available"
data$dataset16$origin_therapy = "Not Available"


gene_fre = list()
for(i in names(data)){
  m = sort(colSums(data[[i]] == "Mutation"),decreasing = T)
  m = m[m !=0 & !names(m) %in% c("Unknown","")]
  gene_fre[[i]] = names(m)
}

dataset2_detial = read.csv("/web/Refence_datasets/Refence_datasets(with_therapy)/dataset2/origin_data/Allen TableS1.Mutation_list_all_patients.csv")

gene_fre$dataset2 = gene_fre$dataset2[ !gene_fre$dataset2 %in% unique(dataset2_detial$Hugo_Symbol[ dataset2_detial$Entrez_Gene_Id == "?" ]) ]
sapply(data,nrow)

saveRDS(data,"Integrate_data/Refence_datasets_with_therapy.rds")
saveRDS(gene_fre,"Integrate_data/Refence_datasets_gene_maf_with_therapy.rds")

#################################################################################
dataset1_2.1 = read.table("./dataset1/result_data/dataset1_mutation_Bladder_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.2 = read.table("./dataset1/result_data/dataset1_mutation_Breast_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.3 = read.table("./dataset1/result_data/dataset1_mutation_Colorectal_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.4 = read.table("./dataset1/result_data/dataset1_mutation_Esophagogastric_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.5 = read.table("./dataset1/result_data/dataset1_mutation_Glioma.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.6 = read.table("./dataset1/result_data/dataset1_mutation_Head_and_Neck_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.7 = read.table("./dataset1/result_data/dataset1_mutation_Melanoma.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.8 = read.table("./dataset1/result_data/dataset1_mutation_Non-Small_Cell_Lung_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset1_2.9 = read.table("./dataset1/result_data/dataset1_mutation_Renal_Cell_Carcinoma.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)

dataset3_2.1 = read.table("./dataset3/result_data/dataset3_mutation_Bladder_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset3_2.2 = read.table("./dataset3/result_data/dataset3_mutation_Melanoma.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset3_2.3 = read.table("./dataset3/result_data/dataset3_mutation_Non-Small_Cell_Lung_Cancer.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)


dataset1_2 = read.table("./dataset1/result_data/dataset1_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset2_2 = read.table("./dataset2/result_data/dataset2_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset3_2 = read.table("./dataset3/result_data/dataset3_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset4_2 = read.table("./dataset4/result_data/dataset4_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset5_2 = read.table("./dataset5/result_data/dataset5_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset6_2 = read.table("./dataset6/result_data/dataset6_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset7_2 = read.table("./dataset7/result_data/dataset7_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset8_2 = read.table("./dataset8/result_data/dataset8_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset9_2 = read.table("./dataset9/result_data/dataset9_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset10_2 = read.table("./dataset10/result_data/dataset10_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset12_2 = read.table("./dataset12/result_data/dataset12_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset14_2 = read.table("./dataset14/result_data/dataset14_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset15_2 = read.table("./dataset15/result_data/dataset15_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset16_2 = read.table("./dataset16/result_data/dataset16_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset17_2 = read.table("./dataset17/result_data/dataset17_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset18_2 = read.table("./dataset18/result_data/dataset18_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset19_2 = read.table("./dataset19/result_data/dataset19_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset20_2 = read.table("./dataset20/result_data/dataset20_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset21_2 = read.table("./dataset21/result_data/dataset21_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset22_2 = read.table("./dataset22/result_data/dataset22_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)
dataset23_2 = read.table("./dataset23/result_data/dataset23_mutation.txt",sep = "\t",quote = "",header = T,check.names = F,stringsAsFactors = F)



dataset14_2$ID = do.call("rbind",strsplit(dataset14_2$ID,"-"))[,1]

library(reshape2)
dataset11_2 = dataset11_1[,-(1:6)]
dataset11_2$ID = rownames(dataset11_2)
dataset11_2 = melt(dataset11_2,id.vars = "ID")  
dataset11_2 = dataset11_2[dataset11_2$value == "Mutation",]
dataset11_2$value = "All"
colnames(dataset11_2) = c("ID","Hugo_Symbol","Variant_Classification")

dataset13_2 = dataset13_1[,-(1:5)]
dataset13_2$ID = rownames(dataset13_2)
dataset13_2 = melt(dataset13_2,id.vars = "ID")  
dataset13_2 = dataset13_2[dataset13_2$value == "Mutation",]
dataset13_2$value = "All"
colnames(dataset13_2) = c("ID","Hugo_Symbol","Variant_Classification")


datasets_mu = list("dataset1.1" = dataset1_2.1,
                   "dataset1.2" = dataset1_2.2,
                   "dataset1.3" = dataset1_2.3,
                   "dataset1.4" = dataset1_2.4,
                   "dataset1.5" = dataset1_2.5,
                   "dataset1.6" = dataset1_2.6,
                   "dataset1.7" = dataset1_2.7,
                   "dataset1.8" = dataset1_2.8,
                   "dataset1.9" = dataset1_2.9,
                   "dataset1" = dataset1_2,
                   "dataset2" = dataset2_2,
                   "dataset3.1" = dataset3_2.1,
                   "dataset3.2" = dataset3_2.2,
                   "dataset3.3" = dataset3_2.3,
                   "dataset3" = dataset3_2,
                   "dataset4" = dataset4_2,
                   "dataset5" = dataset5_2,
                   "dataset6" = dataset6_2,
                   "dataset7" = dataset7_2,
                   "dataset8" = dataset8_2,
                   "dataset9" = dataset9_2,
                   "dataset10" = dataset10_2,
                   "dataset11" = dataset11_2,
                   "dataset12" = dataset12_2,
                   "dataset13" = dataset13_2,
                   "dataset14" = dataset14_2,
                   "dataset15" = dataset15_2,
                   "dataset16" = dataset16_2,
                   "dataset17" = dataset17_2,
                   "dataset18" = dataset18_2,
                   "dataset19" = dataset19_2,
                   "dataset20" = dataset20_2,
                   "dataset21" = dataset21_2,
                   "dataset22" = dataset22_2,
                   "dataset23" = dataset23_2
                   )

for(i in names(datasets_mu)){
  # message(sum(!rownames(data[[i]]) %in% datasets_mu[[i]]$ID))
  message(sum(!datasets_mu[[i]]$ID %in% rownames(data[[i]])))  #dataset1 和 dataset11存在部分患者一个panel基因都不突变！！ 
}

saveRDS(datasets_mu,"Integrate_data/Refence_datasets_mutation_with_therapy.rds")

#############################################################################
dataset2_rna_wes = readRDS("dataset2/result_data/datasets2_rna_wes.rds")
dataset6_rna_wes = readRDS("dataset6/result_data/datasets6_rna_wes.rds")
dataset8_rna_wes = readRDS("dataset8/result_data/datasets8_rna_wes.rds")
dataset10_rna_wes = readRDS("dataset10/result_data/datasets10_rna_wes.rds")
dataset11_rna_wes = readRDS("dataset11/result_data/datasets11_rna_wes.rds")
dataset12_rna_wes = readRDS("dataset12/result_data/datasets12_rna_wes.rds")
dataset13_rna_wes = readRDS("dataset13/result_data/datasets13_rna_wes.rds")
dataset14_rna_wes = readRDS("dataset14/result_data/datasets14_rna_wes.rds")
dataset20_rna_wes = readRDS("dataset20/result_data/datasets20_rna_wes.rds")
dataset21_rna_wes = readRDS("dataset21/result_data/datasets21_rna_wes.rds")

datasets_rna_wes = list("dataset2" = dataset2_rna_wes$dataset2,
                        "dataset6" = dataset6_rna_wes$dataset6,
                        "dataset8" = dataset8_rna_wes$dataset8,
                        "dataset10"=dataset10_rna_wes$dataset10,
                        "dataset11"=dataset11_rna_wes$dataset11,
                        "dataset12"=dataset12_rna_wes$dataset12,
                        "dataset13"=dataset13_rna_wes$dataset13,
                        "dataset14"=dataset14_rna_wes$dataset14,
                        "dataset20"=dataset20_rna_wes$dataset20,
                        "dataset21"=dataset21_rna_wes$dataset21
                        )

saveRDS(datasets_rna_wes,"Integrate_data/Refence_datasets_rna_wes_with_therapy.rds")

